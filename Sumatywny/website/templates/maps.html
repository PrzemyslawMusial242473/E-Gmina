{% extends "base.html" %}
{% block title %}Mapa{% endblock %}
{% block content %}
<div class="container">
  <div class="bg-primary rounded p-3 mb-4">
    <h1 class="text-white text-center mb-4">Mapa</h1>
  </div>
  <div id="map" style="height: 300px; width: 100%;"></div>
</div>
<div class="container">
  <div class="row">
    <div class="col-md-6">
      <div class="rounded p-3 mx-4">
        <h2 class="bg-primary rounded p-3 text-white mb-3">Dodaj Znacznik</h2>
        <form method="POST">
          <div class="form-group">
            <label for="address">Adres:</label>
            <input type="text" class="form-control" id="address" name="address" required>
          </div>
          <div class="form-group bg-white">
            <label for="description">Opis:</label>
            <input type="text" class="form-control" id="description" name="description">
          </div>
          <button type="submit" class="btn btn-primary">Dodaj Znacznik</button>
        </form>
      </div>
    </div>
    <div class="col-md-6">
      <div class="mt-3 mx-4">
        <h2 class="bg-primary rounded p-3 text-white mb-3 mt-3">Znaczniki</h2>
        {% for marker in markers %}
        <div class="card mb-3">
          <div class="card-body">
            <h5 class="card-title">Adres: {{ marker.address }}</h5>
            <p class="card-text">Opis: {{ marker.description }}</p>
            <form action="{{ url_for('views.delete_marker', marker_id=marker.id) }}" method="post">
              <button type="submit" class="btn btn-danger">Usuń</button>
            </form>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
<script>
  function initMap() {
    var map = new google.maps.Map(document.getElementById('map'), {
      center: { lat: 51.747585, lng: 19.325453 },
      zoom: 15
    });

    // Pętla tworząca markery dla wszystkich znaczników z bazy danych
    {% for marker in markers %}
    var marker = new google.maps.Marker({
      position: { lat: parseFloat('{{ marker.lat }}'), lng: parseFloat('{{ marker.lng }}') },
      map: map,
      title: '{{ marker.address }}',
      address: '{{ marker.address }}',  // Przechowujemy adres w właściwości markerów
      description: '{{ marker.description }}'  // Przechowujemy opis w właściwości markerów
    });

    var infoWindow = new google.maps.InfoWindow(); // Tworzymy infoWindow dla danego markera

    marker.addListener('click', function() {
      var infoWindowContent = '<div><h5>' + this.address + '</h5><p>' + this.description + '</p></div>';
      infoWindow.setContent(infoWindowContent); // Ustawiamy treść infoWindow dla danego markera
      infoWindow.open(map, this); // Otwieramy infoWindow dla danego markera
    });
    {% endfor %}
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDgRv7f0CZS1zchzAV9WsXTMRrCmIHxY_M&callback=initMap" async defer></script>
{% endblock %}

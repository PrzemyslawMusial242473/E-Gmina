{% extends "base.html" %}
{% block title %}Send Invitation{% endblock %}
{% block content %}
  <h1 align="center">Znajomi</h1>
  <form method="POST">
    <div class="form-group">
      <label for="inputEmail">Adres email</label>
      <input type="email" class="form-control" id="inputEmail" name="email" placeholder="Wpisz email">
    </div>
    <button type="submit" class="btn btn-primary">Wyślij zaproszenie</button>
  </form>

  <h1>Lista znajomych</h1>
  <ul>
    {% if user.friends %}
      {% for friend in user.friends %}
        <li>{{ friend.email }} <a class="btn btn-primary" href="/chat/{{ friend.id }}">Chat</a></li>
      {% endfor %}
    {% else %}
      <p>No friends yet.</p>
    {% endif %}
  </ul>

  <h1>Wysłane zaproszenia</h1>
  <ul>
    {% if user.invitations %}
      {% for invite in user.invitations %}
        <li>{{ invite.email }}<button class="btn btn-success" onclick="acceptInvite('{{ invite.email }}')">Zaakceptuj</button> <button class="btn btn-danger" onclick="rejectInvite('{{ invite.email }}')">Odrzuć</button></li>
      {% endfor %}
    {% else %}
      <p>No invitations.</p>
    {% endif %}
  </ul>


  <script>
    function acceptInvite(email) {
        fetch("/accept-invite", {
            method: "POST",
            body: JSON.stringify({ inviter_email: email }),
        }).then((_res) => {
            window.location.reload();
        });
    }

    function rejectInvite(email) {
        fetch("/reject-invite", {
            method: "POST",
            body: JSON.stringify({ inviter_email: email }),
        }).then((_res) => {
            window.location.reload();
        });
    }
  </script>
{% endblock %}
{% extends "base.html" %}
{% block title %}Chat{% endblock %}
{% block content %}
  <h1>Chat with {{ receiver.email }}</h1>
  <div id="messages">
    {% for message in messages %}
      {% if message.sender_id == current_user.id %}
        <p><strong>You: </strong>{{ message.content }}</p>
      {% else %}
        <p><strong>{{ receiver.email }}: </strong>{{ message.content }}</p>
      {% endif %}
    {% endfor %}
  </div>
  <form id="message-form">
    <input type="text" id="message-content" name="content" placeholder="Type your message">
    <button type="submit">Send</button>
  </form>
  <script>
    document.getElementById('message-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const content = document.getElementById('message-content').value;
      fetch("/send-message/{{ receiver.id }}", {
        method: "POST",
        body: new URLSearchParams({ content: content }),
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        }
      }).then(response => {
        if (response.ok) {
          window.location.reload();
        }
      });
    });
  </script>
{% endblock %}
